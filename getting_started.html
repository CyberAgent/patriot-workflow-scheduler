

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; patriot-workflow-scheduler 0.7.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="patriot-workflow-scheduler 0.7.2 documentation" href="index.html"/>
        <link rel="next" title="Architecture" href="arch.html"/>
        <link rel="prev" title="Patriot Workflow Scheduler" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> patriot-workflow-scheduler
          

          
          </a>

          
            
            
              <div class="version">
                0.7.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-execution">Job Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependency-configuration">Dependency Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-workers-with-jobstore">Running workers with JobStore</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="arch.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbc.html">Job Configuration DSL (PBC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="web.html">Web Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">System Configuration</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">patriot-workflow-scheduler</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/getting_started.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Ruby ( &gt;= 1.9 )</li>
<li>MySQL ( recommended for production use )</li>
</ul>
</div>
<div class="section" id="install">
<h2>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>% sudo gem install patriot-workflow-scheduler
% patriot-init ${INSTALL_DIR}
</pre></div>
</div>
</div>
<div class="section" id="job-execution">
<h2>Job Execution<a class="headerlink" href="#job-execution" title="Permalink to this headline">¶</a></h2>
<p>Command line tools are available for processing jobs defined in <a class="reference internal" href="pbc.html"><em>PBC</em></a>.
The tool can be triggered by <a class="reference internal" href="cli.html"><em>the patriot script</em></a>.
The script takes three arguments: a tool name (&#8216;execute&#8217; for job execution), a target date of the jobs (in yyyy-MM-dd) and a path to the PBC file. In processing the PBC files, a variable &#8216;_date_&#8217; will be replaced with the target date.</p>
<div class="highlight-python"><div class="highlight"><pre>% cd ${INSTALL_DIR}
% ./bin/patriot execute 2015-04-01 batch/sample/daily/test.pbc
</pre></div>
</div>
<p>The initial target of this scheduler is daily batch jobs and the
script takes a date (or range of dates) as an argument.</p>
</div>
<div class="section" id="dependency-configuration">
<h2>Dependency Configuration<a class="headerlink" href="#dependency-configuration" title="Permalink to this headline">¶</a></h2>
<p>Dependencies between jobs are defined through <em>products</em>.
The products produced/required by jobs are configured by <em>produce</em> and <em>require</em>, respectively.
A job becomes ready to be executed when all products required by the job are available.
The products become available when all jobs which produce the product are finished.</p>
<p>To run jobs according to dependencies, the <em>strict</em> option should be passed to the execution tool.
(or use JobStore explained later)</p>
<div class="highlight-python"><div class="highlight"><pre>% cat flow_sample.pbc
sh{
  require [&#39;product1&#39;] # run after &#39;product1&#39; is created
  name &quot;consumer&quot;
  commands &quot;echo &#39;this is a consumer&#39;&quot;
}
sh{
  produce [&#39;product1&#39;] # this job creates &#39;product1&#39;
  name &quot;producer&quot;
  commands &quot;echo &#39;this is a producer&#39;&quot;
}
% ./bin/patriot execute --strict 2015-04-01 flow_sample.pbc
# execute echo &#39;this is a producer&#39;
# execute echo &#39;this is a consumer&#39;
</pre></div>
</div>
</div>
<div class="section" id="running-workers-with-jobstore">
<h2>Running workers with JobStore<a class="headerlink" href="#running-workers-with-jobstore" title="Permalink to this headline">¶</a></h2>
<p>The JobStore has a role of managing dependency among jobs.
By using the JobStore, multiple jobs can be executed by workers in parallel and distributively (see <a class="reference internal" href="arch.html"><em>architecture</em></a>).</p>
<ol class="arabic">
<li><p class="first">Configure database.</p>
<blockquote>
<div><p>The recommended implementation of JobStore uses MySQL to manage the dependency. So MySQL database and tables should be configured.
The DDL file is included in this repository (in the <a class="reference external" href="https://github.com/CyberAgent/patriot-workflow-scheduler/tree/develop/misc">misc</a> directory).</p>
<p>The below four variables have to be set by users.</p>
<ul class="simple">
<li>PATRIOT_DB : database which stores workflow information</li>
<li>PATRIOT_DBHOST : host where database is located</li>
<li>PATRIOT_USER : user for accessing the database</li>
<li>PATRIOT_PASSWORD : password for accessing the database</li>
</ul>
<p>To configure the database, login to the PATRIOT_DBHOST, then</p>
<div class="highlight-python"><div class="highlight"><pre>% mysql -u root -p
&gt; create database ${PATRIOT_DB};
&gt; grant all on ${PATRIOT_DB}.* to ${PATRIOT_USER}@&#39;%&#39; identified by &#39;${PATRIOT_PASSWORD}&#39;;
( &gt; grant all on ${PATRIOT_DB}.* to ${PATRIOT_USER}@&#39;localhost&#39; identified by &#39;${PATRIOT_PASSWORD}&#39;; # if case of localhost)
&gt; exit;
% mysql -u ${PATRIOT_USER} -h ${PATRIOT_DBHOST} --password=${PATRIOT_PASSWORD} ${PATRIOT_DB} &lt;  misc/mysql.sql
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Install the DB adapter</p>
<blockquote>
<div><p>The DB adapter is included in the this repository and is implemented as a plugin.</p>
<div class="highlight-python"><div class="highlight"><pre>% cd ${CLONE_DIR}/plugins/patriot-mysql2-client
% gem build patriot-mysql2-client.gemspec
% sudo gem install patriot-mysql2-client-${VERSION}.gem
</pre></div>
</div>
<p>then</p>
<div class="highlight-python"><div class="highlight"><pre>% cd ${INSTALL_DIR}
% ./bin/patriot plugin install ${CLONE_DIR}/plugins/patriot-mysql2-client/patriot-mysql-client-${VERSION}.gem
</pre></div>
</div>
<p>For more detail on the plugin tool, please refer to <a class="reference internal" href="cli.html#cli-plugin"><span>the CLI page</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Configure JobStore and workers.</p>
<blockquote>
<div><p>An example configuration is as below.
See <a class="reference internal" href="config.html"><em>system configuration</em></a> for more detail.</p>
<div class="highlight-python"><div class="highlight"><pre>% cat ${INSTALL_DIR}/config/patriot.ini
[common]
plugins=patriot-mysql2-client
jobstore.root.class=Patriot::JobStore::RDBJobStore
jobstore.root.adapter=mysql2
jobstore.root.database=${PATRIOT_DB}
jobstore.root.host=${PATRIOT_DBHOST}
jobstore.root.username=${PATRIOT_USER}
jobstore.root.password=${PATRIOT_PASSWORD}

log_factory = Patriot::Util::Logger::Log4rFactory
log_level   = INFO
log_format  = &quot;[%l] %d %C (%h) : %m&quot;
log_outputters = stdout
log_outputter.stdout.class = Log4r::StdoutOutputter

[worker]
nodes=test
node.test.type=any
node.test.threads=1
log_outputters = file
log_outputter.file.class = Log4r::DateFileOutputter
log_outputter.file.dir =  ${LOG_DIR}
log_outputter.file.file = patriot-worker.log
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Start a worker</p>
<blockquote>
<div><p>A worker process for executing jobs stored in the JobStore can be started by <a class="reference internal" href="cli.html#cli-worker"><span>the worker tool</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre>% mkdir ${LOG_DIR} # if necessary
% sudo ./bin/patriot worker start
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Register jobs</p>
<blockquote>
<div><p>Jobs defined in PBC files can be registered to the JobStore by <a class="reference internal" href="cli.html#cli-register"><span>the register tool</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre>% ${INSTALL_DIR}/bin/patriot register YYYY-mm-DD ${batch config file}
</pre></div>
</div>
<p>The jobs defined in the batch config file will be executed by the worker.
See <a class="reference internal" href="pbc.html"><em>batch config</em></a> for more detail on batch config files.</p>
<p>In addition, a job management web console is available at &#8216;<a class="reference external" href="http:/">http:/</a>/${HOST}:36104/jobs/&#8217;</p>
</div></blockquote>
</li>
</ol>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="arch.html" class="btn btn-neutral float-right" title="Architecture" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Patriot Workflow Scheduler" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Cyberagent, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>